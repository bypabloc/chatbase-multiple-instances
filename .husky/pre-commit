#!/usr/bin/env sh

echo "
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸ”’ PRE-COMMIT CHECKS                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"

# Check if we're trying to commit directly to protected branches
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

echo "ğŸ” Branch protection check..."
echo "   Current branch: $CURRENT_BRANCH"

# Check against protected branches (including master)
if [ "$CURRENT_BRANCH" = "dev" ] || [ "$CURRENT_BRANCH" = "main" ] || [ "$CURRENT_BRANCH" = "master" ]; then
        echo ""
        echo "âŒ COMMIT BLOCKED!"
        echo ""
        echo "ğŸš« Direct commits to '$CURRENT_BRANCH' branch are not allowed"
        echo ""
        echo "ğŸ“‹ Required workflow:"
        echo "   1. Create a feature branch from dev:"
        echo "      git checkout dev"
        echo "      git pull origin dev"
        echo "      git checkout -b feature/your-feature-name"
        echo ""
        echo "   2. Make your changes and commit to the feature branch"
        echo ""
        echo "   3. Push your feature branch:"
        echo "      git push origin feature/your-feature-name"
        echo ""
        echo "   4. Create a Pull Request to merge into dev"
        echo "      This will trigger GitHub Actions for automated verification"
        echo ""
        echo "ğŸ’¡ This ensures:"
        echo "   â€¢ All changes go through CI/CD verification"
        echo "   â€¢ Code review process is followed"
        echo "   â€¢ Quality standards are maintained"
        echo ""
        
        # Special message for master branch
        if [ "$CURRENT_BRANCH" = "master" ]; then
            echo "âš ï¸  MASTER BRANCH PROTECTION:"
            echo "   â€¢ Master is for production releases only"
            echo "   â€¢ All changes must come from dev via PR"
            echo "   â€¢ Only release managers should merge to master"
            echo ""
        fi
        
        exit 1
fi

echo "âœ… Branch protection check passed!"
echo ""

# Run lint-staged for code quality
echo "2ï¸âƒ£  Running code quality checks..."
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
npx lint-staged

if [ $? -eq 0 ]; then
    echo ""
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘          âœ… ALL PRE-COMMIT CHECKS PASSED! ğŸ‰            â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
fi