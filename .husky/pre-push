#!/usr/bin/env sh

echo "
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸš€ PRE-PUSH CHECKS                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"

# Use correct Node.js version
if [ -f .nvmrc ]; then
    echo "ğŸ”„ Switching to Node.js version from .nvmrc..."
    nvm use
    echo ""
fi

# 1. Check code quality
echo "1ï¸âƒ£  Checking code quality with Biome..."
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
pnpm ci:check
if [ $? -ne 0 ]; then
    echo "
âŒ Code quality check failed!
ğŸ’¡ Run 'pnpm check' to fix issues automatically
"
    exit 1
fi
echo "âœ… Code quality check passed!"
echo ""

# 2. Run tests with coverage
echo "2ï¸âƒ£  Running tests with coverage..."
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
pnpm test:coverage
if [ $? -ne 0 ]; then
    echo "
âŒ Tests failed or coverage is below threshold!

ğŸ“Š Required coverage thresholds:
   â€¢ Lines: 90%
   â€¢ Functions: 75%
   â€¢ Branches: 88%
   â€¢ Statements: 90%

ğŸ’¡ Tips:
   â€¢ Run 'pnpm test:coverage' to see detailed results
   â€¢ Check coverage/index.html for visual report
   â€¢ Add more tests to increase coverage
"
    exit 1
fi

echo "
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          âœ… ALL PRE-PUSH CHECKS PASSED! ğŸ‰               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"